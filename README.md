# prtnl-routes
Набор скриптов для организации автоматизированного обновления маршрутов по доменным именам для сервера pritunl.

# pre-req
1. Установленный и настроенный pritunl-server на базе mongodb.
2. Настроены сервера и учетные записи внутри pritunl-server, открыты порты, соединение между клиентом и сервером устанавливается.
3. Установленный python и зависимости:
   ```bash
   apt install python3-pip
   pip install pymongo

# how to use
0. Скопировать репозиторий на сервер с pritunl в хомяк, запускать все скрипты из этой диры.
1. Получить id серверов из базы mongo db, визуально найти id нужных серверов в формате ObjectId("хххххххххххххххххххххххх"):
   ```bash
   mongo
   use pritunl #pritunl - имя вашей базы данных
   db.server.find().pretty #вывести список всех серверов в формате json
   ```
2. Заменить буквенноцифровые значения id серверов из примера в pritunl-server-id-mongo.txt на ваши реальные.
3. Заполнить файл hosts.txt DNS-именами хостов к которым нужно прописать маршрут.
4. Запуститьn nslookup.sh - создаст routes.txt, список маршрутов для pritunl.
```bash
   ./nslookup.sh
   ```
5. Прописать маршруты на сервер:
```bash
  python ./add_routes_to_mongo.py
  ```
6. Добавить в запуск по крону nslookup.sh, add_routes_to_mongo.py
